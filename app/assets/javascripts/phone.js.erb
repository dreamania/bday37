$(document).ready(function(){
	$("#info_phone").mask("999-9999-9999");
  $("#info_input_radio");
	$.ajaxSetup({ cache: true });
	$.getScript('//connect.facebook.net/ko_KR/all.js', function(){
		FB.init({
			appId      : '<%= Rails.application.secrets.fb_app_id %>',
      channelUrl : '//<%= Rails.application.secrets.url %>/channel.html', // Channel file for x-domain comms
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });
		FB.Canvas.setSize();
		FB.Canvas.setAutoGrow();
		$("#facebook_share_link").click(function(e){
			e.preventDefault();
      $.ajax({
          type: "POST",
          url: "/viral_actions.json",
          data: {
            'viral_action[platform]': "Facebook",
            'viral_action[device]': "mobile"
          },
          success: function (data) {
          }
      });
			share();
		});
	});
	$("#kakaotalk_share_link").click(function(e){
		e.preventDefault();
    $.ajax({
      type: "POST",
      url: "/viral_actions.json",
      data: {
        'viral_action[platform]': "Kakaotalk",
        'viral_action[device]': "mobile"
      },
      success: function (data) {
      }
      });
		kakao.link("talk").send({
			msg : "완전 득템 소식~\n피부생일?!\n에센스 선물까지 준다고!?\n\n숨37과 처음 만나는 순간,피부 생일이 시작됩니다.\n\nMake Your Skin Birthday\nsponsored by 숨37\n",
			url : "<%= Rails.application.secrets.url %>",
			appid : "skin_birthday",
			appver : "1.0",
			appname : "",
			type : "link"
		});
	});
  $("#kakaostory_share_link").click(function(e){
    e.preventDefault();
    $.ajax({
      type: "POST",
      url: "/viral_actions.json",
      data: {
        'viral_action[platform]': "Kakaostory",
        'viral_action[device]': "mobile"
      },
      success: function (data) {
      }
      });
    kakao.link("story").send({
      post : "완전 득템 소식~\n피부생일?!\n에센스 선물까지 준다고!?\n\nhttp://"+"<%= Rails.application.secrets.url %>\n\n숨37과 처음 만나는 순간,피부 생일이 시작됩니다.\n\nMake your skin birthday\nSponsored by 숨37",
      appid : "skin_birthday",
      appver : "1.0",
      appname : "Skin Birthday",
      urlinfo : JSON.stringify({
        title:"Skin Birthday",
        desc:"Make your skin birthday Sponsored by 숨37",
        imageurl:["http://i.imgur.com/OOzHQuf.jpg"],
        type:"article"
      })
    });
  });
  $('#select_month').change(function(e){
    e.preventDefault();
    var month;
    var days;
    month = $("#select_month").val();
    if(month === '3'){
      add_days = [20,21,22,23,24,25,26,27,28,29,30,31];
      remove_days = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19];
      $.each(remove_days, function( index, value ){
        $("#select_day option[value="+value+"]").remove();
      });
      $.each(add_days, function( index, value ){
        $("#select_day").append($('<option>',{
          value:value,
          text:value
        }));
      });
    }else if(month === '4'){
      add_days = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19];
      remove_days = [20,21,22,23,24,25,26,27,28,29,30,31];
      $.each(remove_days, function( index, value ){
        $("#select_day option[value="+value+"]").remove();
      });
      $.each(add_days, function( index, value ){
        $("#select_day").append($('<option>',{
          value:value,
          text:value
        }));
      });
    }
  });
});



function share() {
  var text = "첫 구매 고객님께\n시크릿 프로그래밍 에센스(40ml)를 선물로 드립니다.";
  var share_content = {
    method: "feed",
    name: "Skin Birthday",
    link: "<%= Rails.application.secrets.url %>/pc/index",
    picture: '<%= Rails.application.secrets.url + asset_url("sns/facebook_share.jpg") %>',
    caption: "Make your skin birthday Sponsored by 숨37",
    description: text
  };
  FB.ui(share_content, function(response) {
    if(response && response.post_id) {
      track_viral_action(viral_url, "facebook");
      alert("공유되었습니다.");
    }
    else {
      alert("다시 공유해주세요!");
    }
  });
}
